<!DOCTYPE html><html lang="en"><head><title>src/js/components/thumb-size-selector</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../"><meta name="groc-document-path" content="src/js/components/thumb-size-selector"><meta name="groc-project-path" content="src/js/components/thumb-size-selector.js"><link rel="stylesheet" type="text/css" media="all" href="../../../assets/style.css"><script type="text/javascript" src="../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/js/components/thumb-size-selector.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> {
  hasPropertyChanged,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'../helpers/helpers.js'</span>;
<span class="hljs-keyword">import</span> {
  setThumbSize,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'../actions/ui.js'</span>;
<span class="hljs-keyword">import</span> {
  drawThumbs,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'./thumbs.js'</span>;

<span class="hljs-keyword">const</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>);

<span class="hljs-keyword">let</span> store = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">let</span> manifestStore = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">let</span> lastState = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">const</span> Init = (globalStore, globalManifestStore) =&gt; {
  store = globalStore;
  manifestStore = globalManifestStore;
  <span class="hljs-keyword">const</span> thumbSize = <span class="hljs-built_in">window</span>.localStorage ? localStorage.getItem(<span class="hljs-string">'thumbSize'</span>) : <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> thumbSize !== <span class="hljs-string">'undefined'</span> &amp;&amp; thumbSize !== <span class="hljs-literal">null</span>) {
    store.dispatch(setThumbSize(thumbSize));
  } <span class="hljs-keyword">else</span> {
    store.dispatch(setThumbSize(<span class="hljs-number">100</span>));
  }
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Init;

<span class="hljs-keyword">const</span> DOM = {
  $thumbSizeButtons: <span class="hljs-literal">null</span>,
  $thumbSizeSmall: <span class="hljs-literal">null</span>,
  $thumbSizeMedium: <span class="hljs-literal">null</span>,
  $thumbSizeLarge: <span class="hljs-literal">null</span>,

  init() {
    DOM.$thumbSizeButtons = $(<span class="hljs-string">'.thumb-size__button'</span>);
    DOM.$thumbSizeSmall = $(<span class="hljs-string">'.thumb-size__button--small'</span>);
    DOM.$thumbSizeMedium = $(<span class="hljs-string">'.thumb-size__button--medium'</span>);
    DOM.$thumbSizeLarge = $(<span class="hljs-string">'.thumb-size__button--large'</span>);
  },
};

<span class="hljs-keyword">const</span> updateThumbSelectorState = () =&gt; {
  <span class="hljs-keyword">const</span> state = store.getState().ui;
  DOM.$thumbSizeButtons.removeClass(<span class="hljs-string">'thumb-size__button--active'</span>);
  DOM.$thumbSizeButtons.filter(<span class="hljs-string">`button[data-thumb-size=<span class="hljs-subst">${state.thumbSize}</span>]`</span>)
  .addClass(<span class="hljs-string">'thumb-size__button--active'</span>);
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> makeThumbSizeSelector = () =&gt; {
  <span class="hljs-keyword">const</span> choices = manifestStore.getState().thumbSizes;
  DOM.$thumbSizeSmall.attr(<span class="hljs-string">'data-thumb-size'</span>, choices[<span class="hljs-number">0</span>]);
  DOM.$thumbSizeMedium.attr(<span class="hljs-string">'data-thumb-size'</span>, choices[<span class="hljs-number">1</span>]);
  DOM.$thumbSizeLarge.attr(<span class="hljs-string">'data-thumb-size'</span>, choices[<span class="hljs-number">2</span>]);
  updateThumbSelectorState();
};

<span class="hljs-keyword">const</span> Events = {
  domReady() {
    DOM.init();
    DOM.$thumbSizeButtons.click(Events.sizeClick);
    store.subscribe(Events.storeSubscribe);
  },
  sizeClick() {
    <span class="hljs-keyword">const</span> thumbSizeToSet = $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'data-thumb-size'</span>);
    $(<span class="hljs-keyword">this</span>).blur();
    localStorage.setItem(<span class="hljs-string">'thumbSize'</span>, thumbSizeToSet);
    store.dispatch(setThumbSize(thumbSizeToSet));
    drawThumbs();
  },
  storeSubscribe() {
    <span class="hljs-keyword">const</span> state = store.getState().ui;
    <span class="hljs-keyword">if</span> (hasPropertyChanged(<span class="hljs-string">'thumbSize'</span>, state, lastState)) {
      updateThumbSelectorState();
    }
    lastState = state;
  },
};

$(<span class="hljs-built_in">document</span>).ready(Events.domReady);</div></div></div></div></body></html>